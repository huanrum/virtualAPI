<style>
    .ios-header {
        position: fixed;
        z-index: 9999;
        top: 0;
        left: 0;
        line-height: 20px;
        width: 100%;
        text-align: center;
        color: #d3d3d3;
    }

    .debug .tng-input.select .input option {
        color: #333333;
    }

    .debug .tng-input.select .input option.placeholder_op {
        color: #d3d3d3;
    }

    .scaning {
        display: -webkit-flex;
        display: flex;
        text-align: center;
        min-height: 2rem;
        align-items: center;
        justify-content: center;
        color: #00AEEF;

        position: fixed;
        z-index: 9999;
        top: 0;
        left: 0;
        background: rgba(0, 0, 0, 0.2);
        width: 100%;
        height: 100%;
    }

    .scaning .scan-window {
        width: 80%;
        height: 40%;
        border: 1px solid #d3d3d3;
        border-radius: 8px;
    }

    .scaning .scan-window-text {
        animation: scaning 1s infinite;
    }

    .scaning .scan-window-footer {
        position: fixed;
        bottom: 20px;
        left: 0;
        width: 100%;
    }

    .scaning .scan-window-footer * {
        margin: 1rem;
    }

    @keyframes scaning {
        0% {
            transform: translate(0, 0);
        }
        25% {
            transform: translate(0, 100%);
        }
        50% {
            transform: translate(0, 0);
        }
        75% {
            transform: translate(0, -100%);
        }
        100% {
            transform: translate(0, 0);
        }
    }

    .dialog-modal {
        position: fixed;
        top: 50%;
        width: 96%;
        transform: translate(2%, -50%);
        background: #b5d8a8;
        z-index: 9999;
        color: #333333;
        border-radius: 1rem;
        overflow: hidden;
    }

    .dialog-modal .header {
        line-height: 2rem;
        text-align: center;
        background: #9f9966;
        font-weight: 700;
    }

    .dialog-modal .body {
        padding: 1rem;
    }

    .dialog-modal .body .row {
        padding: 0.2rem 1rem;
    }

    .dialog-modal .body .row label {
        font-weight: 700;
    }

    .dialog-modal .body .row input {
        width: 100%;
        padding: 0.25rem;
        margin-top: 0.5rem;
        border-radius: 8px;
    }

    .dialog-modal .body .row input[type=checkbox] {
        zoom: 2;
        width: auto;
        display: block;
        margin: 0 auto;
    }

    .dialog-modal .message {
        color: #ff0000;
        min-height: 2rem;
    }

    .dialog-modal .footer {
        border-top: 1px solid #d3d3d3;
        text-align: center;
    }

    .dialog-modal .footer>* {
        display: inline-block;
        margin: 0.2rem 1rem;
        border: 1px solid #A40036;
        font-weight: 500;
        border-radius: 8px;
        padding: 4px;
    }

    .dialog-modal .self-dialog-select {
        position: relative;
    }

    .dialog-modal .self-dialog-select ul {
        position: absolute;
        background: #1d1414;
        padding: 0.1rem 1rem;
        list-style: none;
        border-radius: 8px;
        color: #00aae2;
    }

    .dialog-modal .self-dialog-select ul li:hover {
        color: #ffffff;
    }

    .helper-buttons {
        z-index: 999999;
        position: fixed;
        right: -165px;
        top: 0px;
        background: rgba(66, 200, 66, 0.5);
        border-radius: 20%;
    }

    .helper-buttons>* {
        display: inline-block;
        width: 40px;
        height: 40px;
        margin-left: 1rem;
        background: rgba(66, 200, 66, 0.5);
        transform: translate(-50%, -40px);
        border-radius: 40%;
        color: #d3ffd3;
        text-align: center;
        padding-top: 10px;
    }

    .helper-buttons.show {
        right: 70px;
        top: 45px;
        background: transparent;
        color: transparent;
    }

    .no-wlan {
        background: #d3d3d3;
        text-decoration: line-through;
    }
</style>
<script id="base">
    (function () {

        var titleColors = [
            'color:#ffffff;background:#339933;border-radius: 8px;padding:0.2rem;',
            'color:#f9f9f9;background:#333333;border-radius: 8px;padding:0.2rem;',
            'color:#333333;background:#999999;border-radius: 8px;',
            'color:#ffffff;background:#333366;border-radius: 8px;',
            'color:#ffff99;background:#999999;border-radius: 8px;'
        ];
        var contentColor = [
            'color:#999999;background:#f3f3f3;padding:0.2rem;',
            'color:#00aeff;background:#fff3f3;padding:0.2rem;',
            'color:#dddddd;background:#f3fff3;padding:0.2rem;'
        ];

        if (!window.console.trace) {
            window.console.error('trace 不可用');
        }

        window.usePathname = (function () {
            var pathname = '';
            for (var i = 0; i < window.location.pathname.length; i++) {
                if (/[a-zA-Z0-9]/.test(window.location.pathname[i])) {
                    pathname += window.location.pathname[i];
                }
            }
            return function (name) {
                return pathname + '_' + name;
            };
        })();

        window.console = new Proxy(window.console, {
            set: function (obj, prop, value) {
                obj[prop] = value;
            },
            get: function (obj, prop) {
                if (!/^log\S+/.test(prop)) {
                    return obj[prop];
                } else {
                    if (localStorage[usePathname('log')] == 'true') {
                        var [i, j] = prop.replace(/^log/, '').split('$');
                        var head = titleColors[i],
                            content = contentColor[j];
                        return function () {
                            var array = Array.prototype.map.call(arguments, i => i);
                            array[0] = (new Date()).toLocaleTimeString() + ' --> ' + array[0];
                            array.splice(1, 0, "      ");
                            var data = ['%c ' + array.filter(i => typeof i !== 'object').join(
                                ' %c ')].concat(array.filter(i => typeof i !== 'object').map(() =>
                                content).concat(array.filter(i => typeof i === 'object')));
                            data[1] = head;
                            data[2] = '';
                            if (localStorage[usePathname('trace')] == 'true') {
                                window.console.trace(...data);
                            } else {
                                window.console.log(...data);
                            }
                        };
                    } else if (localStorage[usePathname('trace')] == 'true') {
                        return window.console.trace;
                    } else {
                        return () => {};
                    }
                }
            }
        });

    })();

    window.$$login = function(_base,device,username,password){
        return Promise.resolve(JSON.stringify({data:{response:'{"status":"success"}'}}));
    };

    window.$$updateToken = function(_base,response){
        return Promise.resolve();
    };
</script>

<script id="common">
    (function () {
        window.$$simulator = (function () {
            var baseName
            var baseMethods = {
                wlan: localStorage[usePathname('wlan')] == 'true'
            };

            /****************method init end******************************************/
            baseMethods.waiting = function (judgeFn) {
                return new Promise(function (succ) {
                    var interval = setInterval(function () {
                        if (judgeFn()) {
                            clearInterval(interval);
                            succ();
                        }
                    }, 10);
                    setTimeout(() => clearInterval(interval), 10000);
                });
            };

            baseMethods.JSONParse = function JSONParse(str, count) {
                count = count || 0;
                try {
                    return JSON.parse(str);
                } catch (e) {
                    if (count < 4) {
                        return baseMethods.JSONParse(decodeURIComponent(str), count + 1);
                    } else {
                        throw 'JSON parse error.';
                    }
                }
            };

            baseMethods.map = function (obj, keyTo, valueTo) {
                var newObj = {};
                obj = obj || {};
                keyTo = keyTo || function (i) {
                    return i;
                };
                valueTo = valueTo || function (i, j) {
                    return j;
                };
                Object.keys(obj).forEach(function (k) {
                    newObj[keyTo(k, obj[k], obj)] = valueTo(k, obj[k], obj);
                });
                return newObj;
            };

            baseMethods.extendParams = function (params, exFn) {
                var result = {};
                exFn = exFn || function () {};
                if (typeof params === 'string') {
                    (params || '').split('&').forEach(function (i) {
                        if (i.trim()) {
                            result[i.split('=').shift()] = decodeURIComponent(i.split('=').pop());
                        }
                    });
                    exFn(result);
                } else {
                    result = params || {};
                    exFn(result);
                }
                return result;
            };


            /*****************new Page***********************************/
            baseMethods.openPage = function (url) {
                var newPage = document.createElement('iframe');
                newPage.style.width = '100%';
                newPage.style.height = '100%';
                newPage.style.position = 'fixed';
                newPage.style.zIndex = '999998';
                newPage.style.top = '0';
                newPage.style.left = '0';
                newPage.style.background = '#ffffff';
                newPage.style.border = 'none';
                newPage.src = url;
                document.body.appendChild(newPage);
            };


            /******************openTake**********************************/
            baseMethods.turnOnScanner = function (options) {
                return baseMethods.openORC(options, {
                    code: window.$$extend.qrCode('S')
                });
            };

            baseMethods.openORC = function (options, dt) {
                var url = location.href,
                    count = 3,
                    cancel = false;

                var getData = () => {
                    return new Promise(function (succ) {
                        if (dt) {
                            succ(dt);
                        } else {
                            var $dt = {
                                "status": "success",
                                "creditCardNumber": '622' + Date.now(),
                                "expiryMonth": Math.ceil(Math.random() * 12),
                                "expiryYear": new Date().getFullYear() + Math.ceil(Math
                                    .random() *
                                    20),
                                "holderName": ''
                            };
                            var length = 4 + Math.ceil(Math.random() * 6)
                            for (var i = 0; i < length; i++) {
                                setTimeout(() => {
                                    $dt.holderName += String.fromCharCode(64 + Math
                                        .ceil(
                                            Math.random() * 26));
                                }, 10 * i);
                            }
                            setTimeout(() => succ($dt), length * 10 + 50);
                        }
                    });
                };

                return new Promise(function (succ) {
                    var takeORC = document.createElement('div');
                    var takeWindow = document.createElement('div');
                    var takeText = document.createElement('div');
                    var takeFooter = document.createElement('div');

                    takeORC.className = 'scaning';
                    takeWindow.className = 'scan-window';
                    takeText.className = 'scan-window-text';
                    takeFooter.className = 'scan-window-footer';
                    takeText.style.position = 'absolute';
                    takeText.innerHTML = "扫描中，请稍后";

                    takeORC.appendChild(takeWindow);
                    takeORC.appendChild(takeText);
                    takeORC.appendChild(takeFooter);
                    document.body.appendChild(takeORC);

                    if (!dt) {
                        var takeCancel = document.createElement('button');
                        var takeFail = document.createElement('button');
                        takeCancel.innerHTML = 'Cancel';
                        takeFail.innerHTML = 'To Faile';
                        takeFooter.appendChild(takeCancel);
                        takeFooter.appendChild(takeFail);
                        takeCancel.onclick = close('cancel');
                        takeFail.onclick = close('fail');
                    }


                    orc(result => {
                        if (result) {
                            getData().then(data => {
                                takeText.innerHTML = data.code || data.creditCardNumber;
                                takeText.style.color = '#99ff99';
                                takeText.className = '';
                                setTimeout(() => {
                                    document.body.removeChild(takeORC);
                                    succ(data);
                                }, 2000);
                            });
                        } else {
                            document.body.removeChild(takeORC);
                            succ({
                                "status": "fail"
                            });
                        }
                    }, 0);

                    function orc(callBack, count) {
                        setTimeout(() => {
                            if (url === location.href && !cancel) {
                                if (Math.random() > 0.8) {
                                    callBack(true);
                                } else if (count < 20) {
                                    orc(callBack, count + 1);
                                } else {
                                    callBack(false);
                                }
                            }
                        }, 3000);
                    }

                    function close(status) {
                        return function () {
                            cancel = true;
                            document.body.removeChild(takeORC);
                            succ({
                                "status": status
                            });
                        }
                    }
                });
            };

            /******************openTake**********************************/
            baseMethods.selectFromGallery = function (options) {
                return baseMethods.openTake(options, 'Select From Gallery');
            };
            baseMethods.openTake = function openTake(options, title) {
                return new Promise(function (succ) {
                    var takePhoto = document.createElement('div');
                    var takePhotoContent = document.createElement('div');
                    var takePhotoButton = document.createElement('div');
                    var takePhotoButtonBack = document.createElement('button');
                    var takePhotoButtonConfirm = document.createElement('button');

                    takePhoto.style.position = 'fixed';
                    takePhoto.style.zIndex = 9999;
                    takePhoto.style.top = 0;
                    takePhoto.style.left = 0;
                    takePhoto.style.background = '#ffffff';
                    takePhoto.style.width = '100%';
                    takePhoto.style.height = '100%';
                    takePhotoContent.style.width = '100%';
                    takePhotoContent.style.color = '#333333';
                    takePhotoContent.style.padding = '1rem';
                    takePhotoContent.style.textAlign = 'center';
                    takePhotoContent.style.fontSize = '20px';
                    takePhotoButton.style.padding = '4rem 1rem';
                    takePhotoButton.style.textAlign = 'center';
                    takePhotoButtonBack.style.margin = '4rem 1rem';
                    takePhotoButtonConfirm.style.margin = '4rem 1rem';

                    takePhotoContent.innerHTML = (title || '模拟拍照界面') + '<br><br>' +
                        '<canvas id="myCanvas" width="' + window.innerWidth +
                        '" height="120"></canvas>';
                    takePhotoButtonBack.innerHTML = '返回';
                    takePhotoButtonConfirm.innerHTML = '确认';
                    takePhotoButton.appendChild(takePhotoButtonBack);
                    takePhotoButton.appendChild(takePhotoButtonConfirm);
                    takePhoto.appendChild(takePhotoContent);
                    takePhoto.appendChild(takePhotoButton);
                    document.body.appendChild(takePhoto);
                    takePhotoButtonBack.onclick = function () {
                        document.body.removeChild(takePhoto);
                        succ('false');
                        APP.$root.loadingShow = false;
                    };
                    takePhotoButtonConfirm.onclick = function () {
                        succ(document.getElementById("myCanvas").toDataURL("image/png"));
                        document.body.removeChild(takePhoto);
                    };

                    (function () {
                        var context = document.getElementById("myCanvas").getContext("2d");
                        var gradient = context.createLinearGradient(0, 0, window.innerWidth,
                            0);
                        gradient.addColorStop("0", "magenta");
                        gradient.addColorStop("0.5", "blue");
                        gradient.addColorStop("1.0", "red");

                        context.fillText(options.msg || '', 20, 20, window.innerWidth - 40);

                        context.fillStyle = gradient;
                        context.font = "20px Georgia";

                        context.fillText(new Date(), 20, 60, window.innerWidth - 40);
                        context.fillText(window.$$ip, 20, 100, window.innerWidth - 40);
                    })();
                });
            };

            /****************fetch init start******************************************/
            var fetchList = {};
            var fetch = window.fetch || function (url, option) {
                var xhr = null,
                    callBack = [],
                    errorBack = [];
                if (window.XMLHttpRequest) {
                    xhr = new window.XMLHttpRequest();
                    if (xhr.overrideMimeType) {
                        xhr.overrideMimeType('text/xml');
                    }
                } else {
                    xhr = new window.ActiveXObject('Microsoft.XMLHTTP');
                }
                xhr.onreadystatechange = onReadyStateChange;
                xhr.open(option.method, url, true);
                xhr.send(option.body);

                return {
                    then: then,
                    error: error
                }

                function onReadyStateChange() {
                    var data = {
                        text: function () {
                            return xhr.responseText;
                        },
                        json: function () {
                            return JSON.parse(xhr.responseText);
                        }
                    };
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        callBack.forEach(function (fn) {
                            data = fn(data) || data;
                        });
                    } else if (xhr.readyState === 3 && xhr.status !== 200) {
                        errorBack.forEach(function (fn) {
                            data = fn(data) || data;
                        });
                    }
                }

                function then(fn) {
                    callBack.push(fn);
                    return this;
                }

                function error(fn) {
                    errorBack.push(fn);
                    return this;
                }
            };

            baseMethods.request = function request(options, isLogin, isCache) {
                var paramStr = null,
                    url = window.location.origin + ((isCache || /^!/.test(options.api)) ? '/' :
                        '/tngMobile/') + options.api.replace(/^!?\/+/g, '');
                var option = {
                    headers: {}
                };
                if (!isLogin) {
                    option.headers = {
                        test: localStorage[usePathname('test')],
                        token: options.token || '',
                        mockapi: options.mockapi
                    };
                }
                if (options.proxy) {
                    url = window.location.origin + '/' + options.proxy;
                    option.headers = {
                        api: options.api
                    };
                } else if (/^(http:|https:)/.test(options.api)) {
                    url = options.api;
                    option.headers = {};
                }

                option.headers["Cache-Control"] = "no-cache";

                if (typeof options.params === 'object' || typeof options.params === 'undefined') {
                    var params = options.params || {};
                    paramStr = Object.keys(params).sort(function (a, b) {
                        return a.length - b.length;
                    }).map(function (k) {
                        if (!/^\d+$/.test(k) && new RegExp(':' + k).test(url)) {
                            url = url.replace(new RegExp(':' + k, 'g'), toString(params[k]));
                        } else {
                            return k + '=' + encodeURIComponent(toString(params[k]));
                        }
                    }).filter(function (i) {
                        return !!i;
                    }).join('&');
                } else {
                    paramStr = (options.params || '');
                }

                url = url + (paramStr ? '?' : '') + paramStr;

                if (!/^(post|put)$/i.test(options.method)) {
                    option.method = options.method || 'GET';
                } else {
                    option.method = options.method || 'POST';
                    option.body = JSON.stringify(options.data);
                }

                return new Promise((succ) => {
                    var fetchKey = url + JSON.stringify(option) + Date.now(); //调试时避免同一个API高并发调用
                    if (fetchList[fetchKey]) {
                        if (fetchList[fetchKey].data) {
                            succ(fetchList[fetchKey].data);
                        } else {
                            fetchList[fetchKey].fns.push(succ);
                        }
                    } else {
                        fetchList[fetchKey] = {
                            fns: [succ],
                            data: null
                        };

                        fetch(url, option).then(function (req) {
                            if (isCache) {
                                window.console.log1$0('cache', decodeURIComponent(
                                    options.params
                                    .key).replace(usePathname(''), ''));
                            } else if (!/^!/.test(options.api)) {
                                window.console.log1$1('api ', options.api);
                            } else {
                                //window.console.log1$2('callBack',options.api);
                            }
                            return req.json();
                        }).then(function (req) {
                            req = req || {
                                status: 'success'
                            };
                            if (req.errorCode === '0001') {
                                keyMethods.key$G();
                            }

                            fetchList[fetchKey].data = JSON.stringify({
                                status: 'success',
                                data: {
                                    response: JSON.stringify(req || {})
                                }
                            });

                            fetchList[fetchKey].fns.forEach(fn => {
                                fn(fetchList[fetchKey].data);
                            });
                            setTimeout(() => {
                                delete fetchList[fetchKey];
                            }, 2000);
                        });
                    }
                });



                function toString(value) {
                    if (typeof value === 'object') {
                        return JSON.stringify(value);
                    } else {
                        return value;
                    }
                }
            }

            baseMethods.message = (function () {
                var messageList = {};
                window.onmessage = function (e) {
                    Object.keys(messageList).forEach(function (_key) {
                        if (e.data.type === _key) {
                            messageList[_key].forEach(f => f(e.data.fn));
                        }
                    })
                };
                return function (type, fn) {
                    if (typeof fn === 'function') {
                        messageList[type] = messageList[type] || [];
                        messageList[type].push(fn)
                    } else {
                        window.parent.postMessage({
                            type,
                            fn
                        }, location.origin);
                    }
                };
            })();


            /****************method init end******************************************/

            //辅助工具
            var keyMethods = {};


            if (window.parent === window) {
                var helper = document.createElement('div');
                helper.className = 'helper-buttons';
                helper.innerHTML = '工具';
                document.body.appendChild(helper);

                var login = document.createElement('div');
                login.className = 'helper-button';
                login.innerHTML = '登录';
                helper.appendChild(login);
                login.onclick = function () {

                    keyMethods['key$G']();
                }

                var setting = document.createElement('div');
                setting.className = 'helper-button';
                setting.innerHTML = '配置';
                helper.appendChild(setting);
                setting.onclick = function () {
                    keyMethods['key$S']();
                };

                var wlan = document.createElement('div');
                wlan.className = 'helper-button';
                wlan.innerHTML = '网络';
                helper.appendChild(wlan);
                wlan.onclick = function () {
                    baseMethods.wlan = !baseMethods.wlan;
                    localStorage[usePathname('wlan')] = baseMethods.wlan;
                    wlanUpdate(helper);
                    wlanUpdate(wlan);
                };

                helper.onclick = function () {
                    if (/show/.test(helper.className)) {
                        helper.className = helper.className.replace(/\s*show/, '');
                    } else {
                        helper.className += ' show ';
                    }
                };

                wlanUpdate(helper);
                wlanUpdate(wlan);

            } else {
                document.body.onkeydown = function (e) {
                    if ((e.altKey || e.ctrlKey || e.shiftKey) && keyMethods['key$' + e.key.toLocaleUpperCase()]) {
                        keyMethods['key$' + e.key.toLocaleUpperCase()]();
                    }
                };
            }

            function wlanUpdate(els) {
                if (baseMethods.wlan) {
                    els.className = els.className.replace(/\s*no-wlan/, '');
                } else {
                    els.className += ' no-wlan ';
                }
            }

            function dialogModal(title, content, buttons, editors, changeFn) {
                var thenList = [];
                if (!dialogModal.show) {
                    dialogModal.show = true;

                    if (!(buttons instanceof Array)) {
                        changeFn = editors;
                        editors = buttons;
                        buttons = null;
                    }

                    title = title || 'Modal Dialog';
                    content = content || '';
                    buttons = buttons || ['!Cancel', 'Confirm'];
                    editors = editors || {};
                    changeFn = changeFn || function () {};

                    var dialog = document.createElement('div');
                    var header = document.createElement('div');
                    var body = document.createElement('div');
                    var error = document.createElement('div');
                    var footer = document.createElement('div');

                    dialog.className = 'dialog-modal';
                    header.className = 'header';
                    body.className = 'body';
                    error.className = 'message';
                    footer.className = 'footer';

                    dialog.appendChild(header);
                    dialog.appendChild(body);
                    dialog.appendChild(error);
                    dialog.appendChild(footer);
                    document.body.appendChild(dialog);

                    header.innerHTML = title;
                    initBody(body, content, editors, changeFn);

                    buttons.forEach(function (btn, index) {
                        var button = document.createElement('div');
                        button.innerHTML = btn.replace(/^!/, '');
                        footer.appendChild(button);
                        button.onclick = function () {
                            if (!/^!/.test(btn)) {
                                thenList.forEach(fn => fn({
                                    btn,
                                    index,
                                    body,
                                    content,
                                    message: function (value) {
                                        error.innerHTML = '' + value;
                                    }
                                }));
                            } else {
                                document.body.removeChild(dialog);
                                dialogModal.show = false;
                            }
                        };
                    });

                    return {
                        then: function (fn) {
                            thenList.push(fn);
                        }
                    };
                }

                function initValue(editor, manageEvent) {
                    switch (Object.prototype.toString.call(editor)) {
                        case '[object Boolean]':
                            var _boolean = document.createElement('input');
                            _boolean.type = 'checkbox';
                            _boolean.checked = editor;
                            return _boolean;
                        case '[object Array]':
                            return window.$$component.arrayElement(editor, manageEvent);
                        default:
                            var _input = document.createElement('input');
                            _input.value = editor;
                            return _input;
                    }
                }

                function initBody(body, content, editors, changeFn) {
                    if (content instanceof Array) {
                        content.forEach(function (con) {
                            initBody(body, con, editors)
                        });
                    } else if (content instanceof HTMLElement) {
                        body.appendChild(content);
                    } else if (typeof content === 'object') {
                        var inputs = Object.keys(content).map(function (key, index) {

                            var labelTextTr = /\[(.*)\]/.exec(key);
                            var valueText = content[key];
                            var editor = editors[key] || editors[key.replace(/\[(.*)\]/g, '')];

                            labelTextTr = labelTextTr && labelTextTr[1] || key;
                            key = key.replace(/\[(.*)\]/g, '');

                            var row = document.createElement('div');
                            var label = document.createElement('label');
                            var valueParent = initValue(editor);
                            var value = valueParent.el || valueParent;

                            value.value = valueText;
                            label.innerHTML = labelTextTr;

                            row.className = 'row';
                            row.appendChild(label);
                            row.appendChild(valueParent);
                            body.appendChild(row);

                            Object.defineProperty(content, key, {
                                get: function () {
                                    if (Object.prototype.toString.call(editor) ===
                                        '[object Boolean]') {
                                        return value.checked;
                                    } else {
                                        return value.value;
                                    }
                                    return value.value || value.checked;
                                },
                                set: function (val) {
                                    if (Object.prototype.toString.call(editor) ===
                                        '[object Boolean]') {
                                        value.checked = val;
                                    } else {
                                        value.value = val;
                                    }
                                }
                            });

                            value.addEventListener('change', function (e) {
                                setTimeout(() => changeFn(key, content), 200);
                            });

                            value.addEventListener('keyup', function (e) {
                                if (e.keyCode == 13) {
                                    if (inputs[index + 1]) {
                                        inputs[index + 1].focus();
                                    } else {
                                        thenList.forEach(fn => fn({
                                            value,
                                            key,
                                            body,
                                            content,
                                            message: function (value) {
                                                error.innerHTML = '' +
                                                    value;
                                            }
                                        }));
                                    }
                                }
                            });
                            return value;
                        });
                        inputs[0].focus();
                    } else {
                        body.innerHTML = content;
                    }
                }
            }

            /*************************************************************************************/
            keyMethods.key$L = function () {
                var url = window.location.origin + `/cache/${usePathname('language')}?append`;
                dialogModal('Language', {
                    key: '',
                    en: '',
                    'zh-cn': '',
                    'zh-hk': '',
                    'dev-lang': ''
                }).then(function (scope) {
                    var key = scope.content.key;
                    delete scope.content.key;
                    fetch(url, {
                        method: 'POST',
                        body: JSON.stringify({
                            [key]: scope.content
                        })
                    }).then(function () {
                        window.console.log2$0(scope.content);
                    });
                });
            };

            keyMethods.key$G = function () {
                baseMethods.request({
                    method: 'get',
                    api: 'cache/:key',
                    params: {
                        key: encodeURIComponent(usePathname('username'))
                    }
                }, false, true).then(function (req) {
                    var users = JSON.parse(JSON.parse(req).data.response);
                    users = users instanceof Array ? users : [];

                    dialogModal('登录', {
                        'username[用户名]': localStorage[usePathname('username')] || '',
                        'password[密码]': localStorage[usePathname('password')] || ''
                    }, {
                        username: users.map(i => i.split('/')[0]),
                        password: ''
                    }, function (key, content) {
                        if (key === 'username') {
                            var password = users.filter(i => i.split('/')[0] ===
                                    content.username)
                                .shift();
                            if (password && password.split('/')[1]) {
                                content.password = password.split('/')[1];
                            }
                        }
                    }).then(function (scope) {

                        localStorage[usePathname('username')] = scope.content.username;
                        localStorage[usePathname('password')] = scope.content.password;

                        window.$$login(baseMethods, window.$$device, scope.content.username
                            .trim(), scope.content.password.trim()).then(function (
                            req) {
                            var response = JSON.parse(JSON.parse(req).data.response);
                            if (response.status === 'success') {
                                var user = users.filter(i => new RegExp('^' +
                                    scope
                                    .content.username.trim() + '/?').test(
                                    i)).pop();

                                users = users.filter(i => i !== user);
                                users.push(scope.content.username.trim() + '/' +
                                    scope.content.password.trim());
                                baseMethods.request({
                                    method: 'post',
                                    api: 'cache/:key',
                                    params: {
                                        key: encodeURIComponent(
                                            usePathname('username')
                                        )
                                    },
                                    data: users
                                }, false, true);
                                window.$$updateToken(baseMethods,response).then(function () {
                                    setTimeout(function () {
                                        location.reload();
                                    }, 2000);

                                });
                            } else {
                                scope.message(response.errorZhCN);
                            }
                        });
                    });
                });
            };

            keyMethods.key$S = function () { //trace
                var kv = {
                    merge: '合并拆分在多级文件夹下的代码,可以避免代码加载顺序导致的错误',
                    log: '输出标记了各种不同样式的模拟原生的日志',
                    trace: '输出所有日志对应的调用堆栈,可以更方便调试',
                    mockapi: '服务端是否使用moke数据',
                    type: 'AH/PA要显示的类型,显示全部空留空,可以是多个templateId用逗号连接',
                    test: '使用_dev使模拟服务器里面不在只是显示配好的数据，而是可以添加自己的逻辑(一般不需要关心)'
                };

                var getValue = k => {
                    if (k !== 'type') {
                        return window.localStorage[usePathname(k)] == 'true';
                    } else {
                        return window.localStorage[usePathname(k)] || '';
                    }
                };

                dialogModal('设置',
                    baseMethods.map(kv, (k, v) => k + '[' + v + ']', k => window.localStorage[
                        usePathname(k)] || ''),
                    baseMethods.map(kv, k => k, k => getValue(k))).then(function (scope) {
                    Object.keys(kv).forEach(k => window.localStorage[usePathname(k)] = scope.content[
                        k]);
                    location.reload();
                });
            };

            return baseMethods;
        })();

    })();
</script>
<script id="component">
    (function (component) {

        component.arrayElement = function (list) {
            var array = document.createElement('div');
            var arrayInput = document.createElement('input');
            var arrayList = document.createElement('ul');

            arrayInput.onkeyup = function () {
                arrayList.innerHTML = '';
                list.filter(i => i.indexOf(arrayInput.value.trim()) !== -1).forEach(function (ei) {
                    var li = document.createElement('li');
                    arrayList.appendChild(li);
                    li.innerHTML = ei;
                    li.onclick = function () {
                        arrayInput.value = ei;
                        arrayList.style.display = 'none';
                    };
                });
            };
            arrayInput.onfocus = function () {
                arrayList.style.display = 'block';
                arrayInput.onkeyup();
            };
            arrayInput.onblur = function () {
                arrayList.style.display = 'none';
            };

            array.className = 'self-dialog-select';
            array.appendChild(arrayInput);
            array.appendChild(arrayList);

            array.el = arrayInput;
            return array;
        };


    })(window.$$component = {});
</script>